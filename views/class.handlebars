<div class="row text-center" id="title">
	<div class="columns large-12 medium-12 small-12">
		<span class="title" id="className">{{className}}</span>
	</div>
</div>
<div class="row text-center">
	<div class="columns large-8 medium-8 small-8 large-centered small-centered medium-centered">
	{{#if currentGrade}}
		<span>Your current grade is {{currentGrade}}</span>
	{{else}}
		<span>You have not entered enough information for us to calculate your grade</span>
	{{/if}}
	</div>
</div>
<div class="row text-center">
	<div class="columns large-8 medium-8 small-8">
		Desired Percentage
	</div>
	<div class="columns large-4 medium-4 small-4">
		<input id="desiredPercentageInput" type="text" name="desiredPercentage" value="{{desiredGrade}}">
	</div>
</div>
<div class="row">
	<div class="columns large-12 small-12 medium-12">
		{{#if assignments}}
		<table>
		  <thead>
		    <tr>
		      <th>Assignments</th>
		      <th>Extra Credit</th>
		      <th>Weight (in %)</th>
		      <th>Grade Given (in %)</th>
		      <th>Goal</th>
		      <th>Actions</th>
		    </tr>
		  </thead>
		  <tbody>
		      {{#each assignments}}
		      <tr for-assignment="{{assignment}}">
		      	<td>
		      		<span class="assignmentName">
		      			{{assignment}}
		      		</span>
		      	</td>
		      	<td>
		      		<input type="checkbox" name="extraCredit">
		      	</td>
		      	<td>
		      		<span class="assignmentWeight">
		      			<input class="assignmentWeightInput" type="text" Placeholder="Assignment Weight" for-assignment="{{assignment}}" for-class="{{className}}" value="{{weight}}">
		      		</span>
		      	</td>
		      	<td>
		      		<input class="gradeGivenInput" type="text" Placeholder="Grade given" for-assignment="{{assignment}}" for-class="{{className}}" value="{{percentage}}">
		      	</td>
		      	<td>
		      		<span class="desiredGrade">{{desiredPercentage}}</span>
		      	</td>
		      	<td>
		      		<a class="button alert radius deleteAssignmentButton" data-reveal-id="deleteAssignmentModal" for-assignment="{{assignment}}" for-class="{{className}}">Delete</a>
		      	</td>
		      </tr>
		      {{/each}}
		  </tbody>
		</table>
		{{else}}
			<span>You have no assignments!</span>
		{{/if}}
	</div>
</div>

<div id="deleteAssignmentModal" class="reveal-modal" data-reveal>
	<div class="row text-center">
		<div class="columns large-12 small-12 medium-12">
			Are you sure you want to delete this class? It cannot be undone.
		</div>
	</div>
	<div class="row text-center">
		<div class="columns large-12 small-12 medium-12"><a id="confirmDeleteAssignmentButton" class="button alert expand radius">Yes, Delete</a></div>
	</div>
  <a class="close-reveal-modal">&#215;</a>
</div>
<a data-reveal-id="addAssignmentModal" class="button info expand radius large"><span class="button-text">Add an Assignment</span></a>

<div id="addAssignmentModal" class="reveal-modal" data-reveal>
	<form id="addAssignmentForm">
	<div class="row">
		<div class="columns small-12">
			<input type="text" name="assignmentName" placeholder="Assignment Name">
		</div>
	</div>
	<div class="row">
		<div class="columns small-12">
			<input type="text" name="assignmentWeight" placeholder="Assignment Weight">
		</div>
	</div>
	<div class="row">
		<div class="columns small-12">
			<input type="text" name="assignmentPercentage" placeholder="Percent Given (Leave blank if no grade given yet)">
		</div>
	</div>
	<div class="row">
		<div class="columns small-12">
			<a class="button success expand radius large" id="addAssignmentSubmit">Add Assignment</a>
		</div>
	</div>
</form>
  <a class="close-reveal-modal">&#215;</a>
</div>

<script>

	var assignmentToBeDeleted;
	var forClass;

	$('.deleteAssignmentButton').click(function(event) {
		assignmentToBeDeleted = $(this).attr('for-assignment');
		forClass = $(this).attr('for-class');
	});

	$('#confirmDeleteAssignmentButton').click(function(event) {
		$.post('/deleteAssignment', { assignmentName : assignmentToBeDeleted, className : forClass }, function(data) {
			if(data.ok) {
				$('a.close-reveal-modal').trigger('click');
				console.log($('tr[for-assignment="' + assignmentToBeDeleted + '"]'));
				$('tr[for-assignment="' + assignmentToBeDeleted + '"]').remove();
			}
		});
	})

	$('#addAssignmentSubmit').click(function(event) {
		event.preventDefault();
		var assignmentFields = [];
		var $input = $('#addAssignmentForm').find(':input').each(function() {
			assignmentFields.push($(this).val());
		});
		var assignmentName = assignmentFields[0];
		var assignmentWeight = assignmentFields[1];
		var assignmentPercentage = assignmentFields[2];
		var className = $('#className').text();

		$.post('/addAssignment', { className : $('#className').text(),
								   assignmentName : assignmentFields[0],
								   assignmentWeight : assignmentFields[1],
								   assignmentPercentage : assignmentFields[2] }, function(data) {
			if(data.ok) {
				console.log('woo!');
				$('tbody').append('<tr for-assignment="' + assignmentName + '">\
		      	<td>\
		      		<span class="assignmentName">\
		      			' + assignmentName + '\
		      		</span>\
		      	</td>\
		      	<td>\
		      		<input type="checkbox" name="extraCredit">\
		      	</td>\
		      	<td>\
		      		<span class="assignmentWeight">\
		      			<input class="assignmentWeightInput" type="text" Placeholder="Assignment Weight" for-assignment="' + assignmentName + '" for-class="' + className + '" value="' + assignmentWeight + '">\
		      		</span>\
		      	</td>\
		      	<td>\
		      		<input class="gradeGivenInput" type="text" Placeholder="Grade given" for-assignment="' + assignmentName + '" for-class="' + className + '" value="' + assignmentPercentage + '">\
		      	</td>\
		      	<td>\
		      		stub\
		      	</td>\
		      	<td>\
		      		<a class="button alert radius deleteAssignmentButton" data-reveal-id="deleteAssignmentModal" for-assignment="' + assignmentName + '" for-class="' + className + '">Delete</a>\
		      	</td>\
		      </tr>')
				$('a.close-reveal-modal').trigger('click');
			} else {
				console.log('awww :(');
			}
		});
	});

	$('.gradeGivenInput').bind("enterKey", function(e) {
	   var percentage = $(this).val();
	   var assignment = $(this).attr('for-assignment');
	   var className = $(this).attr('for-class');
	   var textbox = $(this);
	   var desiredGrade = $('#desiredPercentageInput').val();
	   var assignmentPercentages = [];
	   var assignmentWeights = [];

	   for(var i = 0; i < $('.assignmentWeightInput').length; i++) {
	   	assignmentWeights.push($('.assignmentWeightInput')[i].value);
	   }

	   for(var i = 0; i < $('.gradeGivenInput').length; i++) {
		assignmentPercentages.push($('.gradeGivenInput')[i].value);
	   }

	   console.log(assignmentPercentages, assignmentWeights);
	   $.post('/updateAssignmentPercentage', { className : className, assignmentPercentage: percentage, assignmentName : assignment}, function(data) {
	   	if(data.ok) {
	   		console.log('uhhhh');
	   		textbox.val(percentage);
	   		$.post('/updateAssignmentGoal', { className : className, assignmentPercentages : assignmentPercentages, assignmentWeights : assignmentWeights, desiredGrade : desiredGrade }, function(data) {
	   			console.log(data);

	   		});
	   	}
	   });
	});

	$('#desiredPercentageInput').bind('enterKey', function(e) {
		var desiredGrade = $(this).val();
		var assignmentPercentages = [];
	   var assignmentWeights = [];

	   for(var i = 0; i < $('.assignmentWeightInput').length; i++) {
	   	assignmentWeights.push($('.assignmentWeightInput')[i].value);
	   }

	   for(var i = 0; i < $('.gradeGivenInput').length; i++) {
		assignmentPercentages.push($('.gradeGivenInput')[i].value);
	   }

		$.post('/updateDesiredGrade', { desiredGrade : desiredGrade, className : $('#className').text() }, function(data) {
			if(data.ok) {
				$.post('/updateAssignmentGoal', { className : className, assignmentPercentages : assignmentPercentages, assignmentWeights : assignmentWeights, desiredGrade : desiredGrade }, function(data) {
					console.log(data);

				});
			}
		});
	});

	$('.assignmentWeightInput').bind('enterKey', function(e) {
		var desiredGrade = $('#desiredPercentageInput').val();
		var assignment = $(this).attr('for-assignment');
		var className = $(this).attr('for-class');
		var weight = $(this).val();
		var assignmentPercentages = [];
	    var assignmentWeights = [];

	    for(var i = 0; i < $('.assignmentWeightInput').length; i++) {
	   		assignmentWeights.push($('.assignmentWeightInput')[i].value);
	    }

	    for(var i = 0; i < $('.gradeGivenInput').length; i++) {
			assignmentPercentages.push($('.gradeGivenInput')[i].value);
	    }

		$.post('/updateAssignmentWeight', { assignmentName : assignment, className : className, weight : weight }, function(data) {
			if(data.ok) {
				$.post('/updateAssignmentGoal', { className : className, assignmentPercentages : assignmentPercentages, assignmentWeights : assignmentWeights, desiredGrade : desiredGrade }, function(data) {
					console.log(data);

				});
			}
		});
	});

	$('.gradeGivenInput, #desiredPercentageInput, .assignmentWeightInput').keyup(function(e){
	    if(e.keyCode == 13)
	    {
	        $(this).trigger("enterKey");
	    }
	});
</script>