<div class="row text-center" id="title">
	<div class="columns large-12 medium-12 small-12">
		<span class="title" id="className">{{className}}</span>
	</div>
</div>
<div class="row text-center">
	<div class="columns large-8 medium-8 small-8">
		Desired Percentage
	</div>
	<div class="columns large-4 medium-4 small-4">
		<input id="desiredPercentageInput" type="text" name="desiredPercentage" value="{{desiredGrade}}">
	</div>
</div>
<div class="row">
	<div class="columns large-12 small-12 medium-12">
		<table>
		  <thead>
		    <tr>
		      <th>Assignments</th>
		      <th>Weight (in %)</th>
		      <th>Grade Given (in %)</th>
		      <th>Goal</th>
		      <th></th>
		    </tr>
		  </thead>
		  <tbody>
		      {{#each assignments}}
		      <tr>
		      	<td>
		      		<span class="assignmentName">
		      			{{assignment}}
		      		</span>
		      	</td>
		      	<td>
		      		<span class="assignmentWeight">
		      			<input class="assignmentWeightInput" type="text" Placeholder="Assignment Weight" for-assignment="{{assignment}}" for-class="{{className}}" value="{{weight}}">
		      		</span>
		      	</td>
		      	<td>
		      		<input class="gradeGivenInput" type="text" Placeholder="Grade given" for-assignment="{{assignment}}" for-class="{{className}}" value="{{percentage}}">
		      	</td>
		      	<td>
		      		{{desiredPercentage}}
		      	</td>
		      	<td>
		      		<a class="button alert radius deleteAssignmentButton" for-assignment="{{assignment}}" for-class="{{className}}">Delete</a>
		      	</td>
		      </tr>
		      {{/each}}
		  </tbody>
		</table>
	</div>
</div>

<a data-reveal-id="addAssignmentModal" class="button info expand radius large"><span class="button-text">Add an Assignment</span></a>

<div id="addAssignmentModal" class="reveal-modal" data-reveal>
	<form id="addAssignmentForm">
	<div class="row">
		<div class="columns small-12">
			<input type="text" name="assignmentName" placeholder="Assignment Name">
		</div>
	</div>
	<div class="row">
		<div class="columns small-12">
			<input type="text" name="assignmentWeight" placeholder="Assignment Weight">
		</div>
	</div>
	<div class="row">
		<div class="columns small-12">
			<input type="text" name="assignmentPercentage" placeholder="Percent Given (Leave blank if no grade given yet)">
		</div>
	</div>
	<div class="row">
		<div class="columns small-12">
			<a class="button success expand radius large" id="addAssignmentSubmit">Add Assignment</a>
		</div>
	</div>
</form>
  <a class="close-reveal-modal">&#215;</a>
</div>

<script>
	$('.deleteAssignmentButton').click(function(event) {
		var assignment = $(this).attr('for-assignment');
		var className = $(this).attr('for-class');

		$.post('/deleteAssignment', { assignmentName : assignment, className : className }, function(data) {
			console.log(data);
		});
	});

	$('#addAssignmentSubmit').click(function(event) {
		event.preventDefault();
		var assignmentFields = [];
		var $input = $('#addAssignmentForm').find(':input').each(function() {
			assignmentFields.push($(this).val());
		})

		$.post('/addAssignment', { className : $('#className').text(),
								   assignmentName : assignmentFields[0],
								   assignmentWeight : assignmentFields[1],
								   assignmentPercentage : assignmentFields[2] }, function(data) {
			if(data) {
				console.log('woo!');
			} else {
				console.log('awww :(');
			}
		});
	});

	$('.gradeGivenInput').bind("enterKey", function(e) {
	   var percentage = $(this).val();
	   var assignment = $(this).attr('for-assignment');
	   var className = $(this).attr('for-class');
	   var textbox = $(this);

	   $.post('/updateAssignmentPercentage', { className : className, assignmentPercentage: percentage, assignmentName : assignment}, function(data) {
	   	console.log(data);
	   	if(data === 'OK') {
	   		console.log('uhhhh');
	   		textbox.replaceWith(percentage);
	   	}
	   });
	});

	$('#desiredPercentageInput').bind('enterKey', function(e) {
		var desiredGrade = $(this).val();

		$.post('/updateDesiredGrade', { desiredGrade : desiredGrade, className : $('#className').text() }, function(data) {
			console.log(data);
		})
	});

	$('.assignmentWeightInput').bind('enterKey', function(e) {
		var assignment = $(this).attr('for-assignment');
		var className = $(this).attr('for-class');
		var weight = $(this).val();
		console.log(assignment, className, weight);

		$.post('/updateAssignmentWeight', { assignmentName : assignment, className : className, weight : weight }, function(data) {
			console.log(data);
		})
	});

	$('.gradeGivenInput, #desiredPercentageInput, .assignmentWeightInput').keyup(function(e){
	    if(e.keyCode == 13)
	    {
	        $(this).trigger("enterKey");
	    }
	});
</script>